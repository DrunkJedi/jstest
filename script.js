var data = {"7592680":{"active":1,"matchid":"7592680","dateofmatch":1449865800000,"sportid":"2","sport":"Баскетбол","categoryid":"103","category":"Международный","tournamentid":"2551","tournament":"Евролига (М), группа А","hometeamid":"558842","hometeam":"БК Страсбург","awayteamid":"430272","awayteam":"БК Химки Москва"},"7592684":{"active":1,"matchid":"7592684","dateofmatch":1449864000000,"sportid":"2","sport":"Баскетбол","categoryid":"103","category":"Международный","tournamentid":"2551","tournament":"Евролига (М), группа А","hometeamid":"6716564","hometeam":"Бавария Мюнхен","awayteamid":"70464","awayteam":"БК Реал М"},"7592782":{"active":1,"matchid":"7592782","dateofmatch":1449866700000,"sportid":"2","sport":"Баскетбол","categoryid":"103","category":"Международный","tournamentid":"2553","tournament":"Евролига (М), группа C","hometeamid":"70453","hometeam":"БК Панатинайкос","awayteamid":"6549987","awayteam":"Стелмет Зелена Гура"},"7611764":{"active":1,"matchid":"7611764","dateofmatch":1449865800000,"sportid":"2","sport":"Баскетбол","categoryid":"189","category":"Бельгия","tournamentid":"1815","tournament":"Баскетбольная Лига Бельгии","hometeamid":"7431583","hometeam":"Лимбург Юнайтед","awayteamid":"890620","awayteam":"Окапи Алстар"},"7611766":{"active":1,"matchid":"7611766","dateofmatch":1449865800000,"sportid":"2","sport":"Баскетбол","categoryid":"189","category":"Бельгия","tournamentid":"1815","tournament":"Баскетбольная Лига Бельгии","hometeamid":"316929","hometeam":"Антверп Джайэнтс","awayteamid":"316932","awayteam":"Теленет Остенде"},"7627694":{"active":1,"matchid":"7627694","dateofmatch":1449954000000,"sportid":"2","sport":"","categoryid":"103","category":"","tournamentid":"2451","tournament":"","hometeamid":"1310768","hometeam":"","awayteamid":"259105","awayteam":""},"7711456":{"active":1,"matchid":"7711456","dateofmatch":1449950400000,"sportid":"2","sport":"","categoryid":"110","category":"","tournamentid":"272","tournament":"","hometeamid":"84454","hometeam":"","awayteamid":"6743974","awayteam":""},"7712000":{"active":1,"matchid":"7712000","dateofmatch":1449864000000,"sportid":"2","sport":"Баскетбол","categoryid":"110","category":"Франция","tournamentid":"2857","tournament":"Про Б","hometeamid":"477820","hometeam":"АЛМ Евреу Баскет","awayteamid":"6404510","awayteam":"Хайрес Тулон"},"7712002":{"active":1,"matchid":"7712002","dateofmatch":1449864000000,"sportid":"2","sport":"Баскетбол","categoryid":"110","category":"Франция","tournamentid":"2857","tournament":"Про Б","hometeamid":"1127543","hometeam":"Ле Портель","awayteamid":"625000","awayteam":"Боулазак Баскет"},"7712004":{"active":1,"matchid":"7712004","dateofmatch":1449864000000,"sportid":"2","sport":"Баскетбол","categoryid":"110","category":"Франция","tournamentid":"2857","tournament":"Про Б","hometeamid":"477815","hometeam":"Херм. де Нантес Атлантик","awayteamid":"885460","awayteam":"Пойтерс Баскет 86"},"7712006":{"active":1,"matchid":"7712006","dateofmatch":1449864000000,"sportid":"2","sport":"","categoryid":"110","category":"","tournamentid":"2857","tournament":"","hometeamid":"5243124","hometeam":"","awayteamid":"5243128","awayteam":""},"7712010":{"active":1,"matchid":"7712010","dateofmatch":1449864000000,"sportid":"2","sport":"Баскетбол","categoryid":"110","category":"Франция","tournamentid":"2857","tournament":"Про Б","hometeamid":"5872193","hometeam":"АС Денаи","awayteamid":"5585024","awayteam":"Сом Булонь-Сюр-мер"},"7760960":{"active":1,"matchid":"7760960","dateofmatch":1449912600000,"sportid":"2","sport":"","categoryid":"113","category":"","tournamentid":"727","tournament":"","hometeamid":"131403","hometeam":"","awayteamid":"131405","awayteam":""},"7794386":{"active":1,"matchid":"7794386","dateofmatch":1449952200000,"sportid":"2","sport":"Баскетбол","categoryid":"111","category":"Германия","tournamentid":"154","tournament":"Бундеслига","hometeamid":"5199261","hometeam":"Феникс Хаген","awayteamid":"5512024","awayteam":"ББК Байреут"},"7794388":{"active":1,"matchid":"7794388","dateofmatch":1449945000000,"sportid":"2","sport":"Баскетбол","categoryid":"111","category":"Германия","tournamentid":"154","tournament":"Бундеслига","hometeamid":"838013","hometeam":"Ратиофарм Ульм","awayteamid":"131707","awayteam":"Фрапорт Скайлайнерс Франкфурт"},"7794392":{"active":1,"matchid":"7794392","dateofmatch":1449952200000,"sportid":"2","sport":"Баскетбол","categoryid":"111","category":"Германия","tournamentid":"154","tournament":"Бундеслига","hometeamid":"131629","hometeam":"МХП Ризен Людвигсбург","awayteamid":"131702","awayteam":"Телеком Бонн"},"7797550":{"active":1,"matchid":"7797550","dateofmatch":1449882000000,"sportid":"2","sport":"","categoryid":"15","category":"","tournamentid":"177","tournament":"","hometeamid":"19400","hometeam":"","awayteamid":"19441","awayteam":""},"7797552":{"active":1,"matchid":"7797552","dateofmatch":1449882000000,"sportid":"2","sport":"Баскетбол","categoryid":"15","category":"США","tournamentid":"177","tournament":"НБА","hometeamid":"19393","hometeam":"Орландо Мэджик","awayteamid":"19395","awayteam":"Кливленд Кавальерс"},"7797554":{"active":1,"matchid":"7797554","dateofmatch":1449882000000,"sportid":"2","sport":"Баскетбол","categoryid":"15","category":"США","tournamentid":"177","tournament":"НБА","hometeamid":"19446","hometeam":"Филадельфия 76ерс","awayteamid":"19396","awayteam":"Детройт Пистонс"},"7797556":{"active":1,"matchid":"7797556","dateofmatch":1449883800000,"sportid":"2","sport":"","categoryid":"15","category":"","tournamentid":"177","tournament":"","hometeamid":"19447","hometeam":"","awayteamid":"19566","awayteam":""},"7797558":{"active":1,"matchid":"7797558","dateofmatch":1449883800000,"sportid":"2","sport":"Баскетбол","categoryid":"15","category":"США","tournamentid":"177","tournament":"НБА","hometeamid":"19389","hometeam":"Торонто Рапторс","awayteamid":"19399","awayteam":"Милуоки Бакс"},"7797560":{"active":1,"matchid":"7797560","dateofmatch":1449885600000,"sportid":"2","sport":"Баскетбол","categoryid":"15","category":"США","tournamentid":"177","tournament":"НБА","hometeamid":"52706","hometeam":"Мемфис Гриззлис","awayteamid":"236032","awayteam":"Шарлотт Хорнетс"},"7797562":{"active":1,"matchid":"7797562","dateofmatch":1449885600000,"sportid":"2","sport":"Баскетбол","categoryid":"15","category":"США","tournamentid":"177","tournament":"НБА","hometeamid":"19449","hometeam":"Нью-Орлеан Пеликанс","awayteamid":"19391","awayteam":"Вашингтон Визардз"},"7797564":{"active":1,"matchid":"7797564","dateofmatch":1449889200000,"sportid":"2","sport":"Баскетбол","categoryid":"15","category":"США","tournamentid":"177","tournament":"НБА","hometeamid":"19392","hometeam":"Денвер Наггетс","awayteamid":"19390","awayteam":"Миннесота Тимбервулвс"},"7797566":{"active":1,"matchid":"7797566","dateofmatch":1449889200000,"sportid":"2","sport":"Баскетбол","categoryid":"15","category":"США","tournamentid":"177","tournament":"НБА","hometeamid":"19403","hometeam":"Юта Джаз","awayteamid":"19404","awayteam":"Оклахома Сити Фандер"},"7797570":{"active":1,"matchid":"7797570","dateofmatch":1449891000000,"sportid":"2","sport":"Баскетбол","categoryid":"15","category":"США","tournamentid":"177","tournament":"НБА","hometeamid":"19448","hometeam":"Финикс Санс","awayteamid":"19408","awayteam":"Портленд Трэйл Блэйзерс"},"7808928":{"active":1,"matchid":"7808928","dateofmatch":1449907200000,"sportid":"2","sport":"","categoryid":"375","category":"","tournamentid":"4234","tournament":"","hometeamid":"731369","hometeam":"","awayteamid":"730044","awayteam":""},"7838666":{"active":1,"matchid":"7838666","dateofmatch":1449937800000,"sportid":"2","sport":"","categoryid":"112","category":"","tournamentid":"595","tournament":"","hometeamid":"5537855","hometeam":"","awayteamid":"6375126","awayteam":""},"7838668":{"active":1,"matchid":"7838668","dateofmatch":1450022400000,"sportid":"2","sport":"","categoryid":"112","category":"","tournamentid":"595","tournament":"","hometeamid":"7116403","hometeam":"","awayteamid":"111966","awayteam":""},"7968664":{"active":1,"matchid":"7968664","dateofmatch":1449865800000,"sportid":"2","sport":"Баскетбол","categoryid":"117","category":"Англия","tournamentid":"747","tournament":"ББЛ","hometeamid":"620655","hometeam":"Surrey Scorchers","awayteamid":"6359196","awayteam":"Манчестер Джаентс"},"7968686":{"active":1,"matchid":"7968686","dateofmatch":1449865800000,"sportid":"2","sport":"Баскетбол","categoryid":"117","category":"Англия","tournamentid":"747","tournament":"ББЛ","hometeamid":"7431217","hometeam":"Leeds Force","awayteamid":"132994","awayteam":"Шеффилд Шаркс"},"7968694":{"active":1,"matchid":"7968694","dateofmatch":1449865800000,"sportid":"2","sport":"Баскетбол","categoryid":"117","category":"Англия","tournamentid":"747","tournament":"ББЛ","hometeamid":"7431216","hometeam":"Bristol Flyers","awayteamid":"426723","awayteam":"Плимаус Райдерз"},"7970134":{"active":1,"matchid":"7970134","dateofmatch":1450030500000,"sportid":"2","sport":"Баскетбол","categoryid":"107","category":"Италия","tournamentid":"269","tournament":"Серия А","hometeamid":"129966","hometeam":"Еа7-Эмпорио Армани Милан","awayteamid":"591147","awayteam":"Упеа Капо Д’орландо"},"7979060":{"active":1,"matchid":"7979060","dateofmatch":1449936000000,"sportid":"2","sport":"Баскетбол","categoryid":"284","category":"Польша","tournamentid":"4084","tournament":"PLKK, Women","hometeamid":"1225371","hometeam":"Muks Poznan","awayteamid":"5254931","awayteam":"Artego Bydgoszcz"},"8035830":{"active":1,"matchid":"8035830","dateofmatch":1450011600000,"sportid":"2","sport":"Баскетбол","categoryid":"109","category":"Испания","tournamentid":"271","tournament":"АСВ Испания","hometeamid":"100604","hometeam":"Эстудиантес","awayteamid":"7367966","awayteam":"Morabanc Andorra"},"8035840":{"active":1,"matchid":"8035840","dateofmatch":1450011600000,"sportid":"2","sport":"Баскетбол","categoryid":"109","category":"Испания","tournamentid":"271","tournament":"АСВ Испания","hometeamid":"84444","hometeam":"CD Baloncesto Sevilla","awayteamid":"101141","awayteam":"Фиатк Ховентут"},"8036442":{"active":1,"matchid":"8036442","dateofmatch":1449943200000,"sportid":"2","sport":"","categoryid":"170","category":"","tournamentid":"1550","tournament":"","hometeamid":"975235","hometeam":"","awayteamid":"267820","awayteam":""},"8038088":{"active":1,"matchid":"8038088","dateofmatch":1449874800000,"sportid":"2","sport":"Баскетбол","categoryid":"263","category":"Бразилия","tournamentid":"2896","tournament":"Новая Баскетбольная лига Бразилии","hometeamid":"959755","hometeam":"Rio Claro Basquete","awayteamid":"8173807","awayteam":"Universo/Vitoria"},"8038094":{"active":1,"matchid":"8038094","dateofmatch":1449874800000,"sportid":"2","sport":"Баскетбол","categoryid":"263","category":"Бразилия","tournamentid":"2896","tournament":"Новая Баскетбольная лига Бразилии","hometeamid":"1492759","hometeam":"Bauru SP","awayteamid":"1492352","awayteam":"Сан Жосе Дус Кампус"},"8048606":{"active":1,"matchid":"8048606","dateofmatch":1449936000000,"sportid":"2","sport":"","categoryid":"168","category":"","tournamentid":"1537","tournament":"","hometeamid":"1156881","hometeam":"","awayteamid":"645112","awayteam":""},"8076042":{"active":1,"matchid":"8076042","dateofmatch":1449867600000,"sportid":"2","sport":"Баскетбол","categoryid":"103","category":"Международный","tournamentid":"2451","tournament":"Адриатическая лига","hometeamid":"8189533","hometeam":"KK Sutjeska","awayteamid":"8001494","awayteam":"Сентхур"},"8090810":{"active":1,"matchid":"8090810","dateofmatch":1449910800000,"sportid":"2","sport":"","categoryid":"483","category":"","tournamentid":"7076","tournament":"","hometeamid":"1155583","hometeam":"","awayteamid":"5913207","awayteam":""},"8090816":{"active":1,"matchid":"8090816","dateofmatch":1449914400000,"sportid":"2","sport":"","categoryid":"483","category":"","tournamentid":"7076","tournament":"","hometeamid":"1155585","hometeam":"","awayteamid":"1424988","awayteam":""},"8090818":{"active":1,"matchid":"8090818","dateofmatch":1449914400000,"sportid":"2","sport":"","categoryid":"483","category":"","tournamentid":"7076","tournament":"","hometeamid":"1155587","hometeam":"","awayteamid":"8200827","awayteam":""},"8090820":{"active":1,"matchid":"8090820","dateofmatch":1449914400000,"sportid":"2","sport":"","categoryid":"483","category":"","tournamentid":"7076","tournament":"","hometeamid":"8200826","hometeam":"","awayteamid":"5913208","awayteam":""},"8090824":{"active":1,"matchid":"8090824","dateofmatch":1449914400000,"sportid":"2","sport":"","categoryid":"483","category":"","tournamentid":"7076","tournament":"","hometeamid":"6870056","hometeam":"","awayteamid":"5913209","awayteam":""},"8090826":{"active":1,"matchid":"8090826","dateofmatch":1449914400000,"sportid":"2","sport":"","categoryid":"483","category":"","tournamentid":"7076","tournament":"","hometeamid":"1155591","hometeam":"","awayteamid":"7482471","awayteam":""},"8090830":{"active":1,"matchid":"8090830","dateofmatch":1449918000000,"sportid":"2","sport":"","categoryid":"483","category":"","tournamentid":"7076","tournament":"","hometeamid":"5266542","hometeam":"","awayteamid":"6445152","awayteam":""},"8090832":{"active":1,"matchid":"8090832","dateofmatch":1449918000000,"sportid":"2","sport":"","categoryid":"483","category":"","tournamentid":"7076","tournament":"","hometeamid":"1155582","hometeam":"","awayteamid":"6450561","awayteam":""},"8110598":{"active":1,"matchid":"8110598","dateofmatch":1449867600000,"sportid":"2","sport":"Баскетбол","categoryid":"109","category":"Испания","tournamentid":"3046","tournament":"Испанская Баскетбольная Лига Золото","hometeamid":"6442445","hometeam":"Капрабо Лерида","awayteamid":"5252736","awayteam":"C. Ourense Baloncesto Sad"},"8110600":{"active":1,"matchid":"8110600","dateofmatch":1449867600000,"sportid":"2","sport":"Баскетбол","categoryid":"109","category":"Испания","tournamentid":"3046","tournament":"Испанская Баскетбольная Лига Золото","hometeamid":"5252735","hometeam":"Quesos Cerrato Palencia","awayteamid":"5575928","awayteam":"Planasa Navarra"},"8110602":{"active":1,"matchid":"8110602","dateofmatch":1449867600000,"sportid":"2","sport":"","categoryid":"109","category":"","tournamentid":"3046","tournament":"","hometeamid":"503956","hometeam":"","awayteamid":"6437826","awayteam":""},"8110604":{"active":1,"matchid":"8110604","dateofmatch":1449867600000,"sportid":"2","sport":"","categoryid":"109","category":"","tournamentid":"3046","tournament":"","hometeamid":"6409308","hometeam":"","awayteamid":"1345792","awayteam":""},"8110610":{"active":1,"matchid":"8110610","dateofmatch":1449867600000,"sportid":"2","sport":"Баскетбол","categoryid":"109","category":"Испания","tournamentid":"3046","tournament":"Испанская Баскетбольная Лига Золото","hometeamid":"8200731","hometeam":"San Pablo Inmobiliaria Burgos","awayteamid":"7452340","awayteam":"CB Prat Joventut"},"8148180":{"active":1,"matchid":"8148180","dateofmatch":1449943200000,"sportid":"2","sport":"Баскетбол","categoryid":"154","category":"Чехия","tournamentid":"1136","tournament":"НБЛ","hometeamid":"5554104","hometeam":"Turi Svitavy","awayteamid":"445734","awayteam":"БК Простежов"},"8148188":{"active":1,"matchid":"8148188","dateofmatch":1449941400000,"sportid":"2","sport":"Баскетбол","categoryid":"154","category":"Чехия","tournamentid":"1136","tournament":"НБЛ","hometeamid":"271125","hometeam":"БК Прага","awayteamid":"271124","awayteam":"БК Дечин"},"8148190":{"active":1,"matchid":"8148190","dateofmatch":1449943200000,"sportid":"2","sport":"Баскетбол","categoryid":"154","category":"Чехия","tournamentid":"1136","tournament":"НБЛ","hometeamid":"208908","hometeam":"БК Опава","awayteamid":"6180648","awayteam":"БК Лионс Жиндричув"},"8185466":{"active":1,"matchid":"8185466","dateofmatch":1449947700000,"sportid":"2","sport":"","categoryid":"188","category":"","tournamentid":"1804","tournament":"","hometeamid":"315467","hometeam":"","awayteamid":"315470","awayteam":""},"8235308":{"active":1,"matchid":"8235308","dateofmatch":1449910800000,"sportid":"2","sport":"","categoryid":"103","category":"","tournamentid":"11873","tournament":"","hometeamid":"8260005","hometeam":"","awayteamid":"8260006","awayteam":""}}

var filterData = function(data){
	var filters = {};
	filters['team'] = document.getElementById("search-team").value.toLowerCase();
	filters['category'] = document.getElementById("filter-category").value;
	filters['tournament'] = document.getElementById("filter-tournament").value;
	filters['date'] = parseInt(document.getElementById("filter-date").value);
	if(filters['category'] != ""){
		var filteredData = {};
		for(id in data){
			if(data[id]['categoryid'] == filters['category'])
				filteredData[id] = data[id];
		}
		data = filteredData;
	}
	if(filters['tournament'] != ""){
		var filteredData = {};
		for(id in data){
			if(data[id]['tournamentid'] == filters['tournament'])
				filteredData[id] = data[id];
		}
		data = filteredData;
	}
	if(filters['date']){
		var filteredData = {};
		for(id in data){
			if(data[id]['dateofmatch'] == filters['date'])
				filteredData[id] = data[id];
		}
		data = filteredData;
	}
	if(filters['team'] != ""){
		var uniqueTeams = {};
		var maskTeams = {};
		var filteredData = {};
		for(id in data){
			if(!uniqueTeams[data[id]['awayteamid']] && data[id]['awayteam'] != "")
				uniqueTeams[data[id]['awayteamid']] = data[id]['awayteam'].toLowerCase();
			if(!uniqueTeams[data[id]['hometeamid']] && data[id]['hometeam'] != "")
				uniqueTeams[data[id]['hometeamid']] = data[id]['hometeam'].toLowerCase();
		}

		for(id in uniqueTeams){
			if(uniqueTeams[id].indexOf(filters['team']) != -1)
				maskTeams[id] = uniqueTeams[id];
		}
		for(id in data){
			for(teamid in maskTeams){
				if(teamid == data[id]['awayteamid'] || teamid == data[id]['hometeamid'])
					filteredData[id] = data[id];
			}
		}
		data = filteredData;
	}
	return data;
}

window.addEventListener('filterchange', function(){rebuildTable(filterData(data));}, false);

var initSearchControlByTeam = function(){
	var element = document.getElementById("search-team");
	element.oninput = function(){
		// generate event
		var event = new Event('filterchange');
		window.dispatchEvent(event);
	}
	return element;
}

var initFilterControlByCategory = function(data){
	var uniqueCategory = {};
	for(id in data){
		if(!uniqueCategory[data[id]['categoryid']] && data[id]['category'] != "")
			uniqueCategory[data[id]['categoryid']] = data[id]['category']
	}
	var element = document.getElementById("filter-category");
	for(id in uniqueCategory){
		element.options[element.options.length] = new Option(uniqueCategory[id], id);
	}
	element.onchange = function(){
		// generate event
		var event = new Event('filterchange');
		window.dispatchEvent(event);
	}
}

var initFilterControlByTournament = function(data){
	var uniqueTournament = {};
	for(id in data){
		if(!uniqueTournament[data[id]['tournamentid']] && data[id]['tournament'] != "")
			uniqueTournament[data[id]['tournamentid']] = data[id]['tournament']
	}
	var element = document.getElementById("filter-tournament");
	for(id in uniqueTournament){
		element.options[element.options.length] = new Option(uniqueTournament[id], id);
	}
	element.onchange = function(){
		// generate event
		var event = new Event('filterchange');
		window.dispatchEvent(event);
	}
}

var initFilterControlByDate = function(data){
	var uniqueDates = [];
	for(id in data){
		if(uniqueDates.indexOf(data[id]['dateofmatch']) == -1)
			uniqueDates.push(data[id]['dateofmatch']);
	}
	var element = document.getElementById("filter-date");
	for(i in uniqueDates){
		element.options[element.options.length] = new Option(new Date(uniqueDates[i]).toString(), uniqueDates[i]);
	}
	element.onchange = function(){
		// generate event
		var event = new Event('filterchange');
		window.dispatchEvent(event);
	}
}

var initControls = function(data){
	initSearchControlByTeam();
	initFilterControlByDate(data);
	initFilterControlByCategory(data);
	initFilterControlByTournament(data);
}

var generateTableContent = function(data){
	var template = "";
	template += "<tr><th>category</th><th>sport</th><th>tournament</th><th>hometeam</th><th>awayteam</th><th>dateofmatch</th></tr>";
	for(id in data){
		if(data[id]['category'] == "")
			continue;
		template += "<tr><td>" + data[id]['category'] + 
					"</td><td>" + data[id]['sport'] + 
					"</td><td>" + data[id]['tournament'] + 
					"</td><td>" + data[id]['hometeam'] + 
					"</td><td>" + data[id]['awayteam'] + 
					"</td><td>" + new Date(data[id]['dateofmatch']).toString() + "</td></tr>";
	}
	
	return template;
}

var rebuildTable = function(data){
	var oldTable = document.getElementById("main-table");
	if(oldTable)
		oldTable.parentNode.removeChild(oldTable);
	var element = document.getElementById("table-container");
	var table = document.createElement("table");
	table.id = "main-table"
	table.innerHTML = generateTableContent(data);
	element.appendChild(table);
}

initControls(data);
rebuildTable(data);